# HelloID Vault SQLite Source System Connector

**Version:** 1.0.0  
**Connector Type:** Source System  
**Database:** SQLite (via Microsoft.Data.Sqlite)

## Overview

This connector reads person and department data from a HelloID Vault SQLite database and makes it available for HelloID's provisioning system. It's designed to work with the HelloID Vault Management application, which consolidates HR data from multiple source systems into a single SQLite database.

### Key Features

- **Multi-Source Support**: Import data from all sources or filter by specific source system
- **Rich Person Data**: Includes personal information, contracts, and contact details
- **Department Hierarchy**: Supports parent/child department relationships
- **Inactive Contract Handling**: Option to include or exclude expired contracts
- **Field Exclusion**: Remove unwanted fields from output (supports wildcards)
- **Debug Mode**: Verbose logging for troubleshooting

---

## Prerequisites

Before configuring this connector, ensure you have:

1. **HelloID.SQLite.dll** - The wrapper DLL that includes Microsoft.Data.Sqlite
   - This DLL enables PowerShell to query SQLite databases
   - Contact your HelloID administrator or obtain from the HelloID Vault Management project

2. **Vault SQLite Database** - The database file containing person and department data
   - Generated by the HelloID Vault Management application
   - Default location: `C:\ProgramData\HelloID.Vault.Management\vault.db`

3. **HelloID Provisioning** - Access to your HelloID environment
   - Permissions to create and configure Source Systems

---

## Installation

### Step 1: Prepare Files

Ensure the following files are accessible on the HelloID agent server:

| File | Recommended Location |
|------|---------------------|
| `vault.db` | `C:\ProgramData\HelloID.Vault.Management\vault.db` |
| `HelloID.SQLite.dll` | `C:\HelloID\SourceData\HelloID.SQLite.dll` |

### Step 2: Create Source System in HelloID

1. Navigate to **Automation > Source Systems** in HelloID
2. Click **Create new source system**
3. Select **Import from scratch** or use this connector as a template
4. Upload the connector scripts:
   - `configuration.json` - Configuration form
   - `persons.ps1` - Person import script
   - `departments.ps1` - Department import script
   - `mapping.json` - Field mapping configuration

### Step 3: Configure the Source System

Configure the connector using the settings below, then save and test.

---

## Configuration Reference

### Database Path

| Setting | Value |
|---------|-------|
| **Field** | `Database Path` |
| **Key** | `databasePath` |
| **Required** | Yes |
| **Description** | Full path to the Vault SQLite database file |

**Example:**
```
C:\ProgramData\HelloID.Vault.Management\vault.db
```

**Notes:**
- Use forward slashes (`/`) or double backslashes (`\\`) in paths
- Ensure the HelloID agent service has read access to this file

---

### Wrapper DLL Path

| Setting | Value |
|---------|-------|
| **Field** | `Wrapper DLL Path` |
| **Key** | `wrapperDllPath` |
| **Required** | Yes |
| **Description** | Full path to HelloID.SQLite.dll |

**Example:**
```
C:\HelloID\SourceData\HelloID.SQLite.dll
```

**Notes:**
- This DLL includes Microsoft.Data.Sqlite and handles database connections
- The file must be accessible by the HelloID agent service

---

### Source System Filter

| Setting | Value |
|---------|-------|
| **Field** | `Source System Filter` |
| **Key** | `sourceFilter` |
| **Required** | No |
| **Description** | Filter data by source system name |

**Example:**
```
HR-System-A
```

**Notes:**
- Leave empty to import data from all source systems
- The filter matches the `source` field stored in the Vault database
- Useful when multiple HR systems feed into the same Vault database

---

### Include Inactive Contracts

| Setting | Value |
|---------|-------|
| **Field** | `Include Inactive Contracts` |
| **Key** | `includeInactiveContracts` |
| **Required** | No |
| **Type** | Checkbox |
| **Default** | Unchecked (inactive contracts excluded) |
| **Description** | Include contracts with end dates in the past |

**Behavior:**
- **Unchecked**: Only active contracts (end date is null or in the future) are imported
- **Checked**: All contracts are imported, including expired ones

**Recommendation:** Keep unchecked for production provisioning to avoid assigning resources to former employees.

---

### Fields to Exclude

| Setting | Value |
|---------|-------|
| **Field** | `Fields to Exclude` |
| **Key** | `fieldsToExclude` |
| **Required** | No |
| **Description** | Comma-separated list of fields to exclude from output |

**Examples:**
```
Source
```
```
Source,custom_*
```
```
Source,custom_*,Contact.Personal.*
```

**Wildcard Support:**
- `*` matches any characters
- `custom_*` excludes all fields starting with `custom_`
- `Contact.Personal.*` excludes all personal contact fields

**Common Use Cases:**
- Exclude `Source` to hide internal source system names
- Exclude `custom_*` to remove custom fields not needed for provisioning
- Exclude `Contact.Personal.*` to keep only business contact information

---

### Debug Mode

| Setting | Value |
|---------|-------|
| **Field** | `Debug Mode` |
| **Key** | `isDebug` |
| **Required** | No |
| **Type** | Checkbox |
| **Default** | Unchecked |
| **Description** | Enable verbose logging for troubleshooting |

**Behavior:**
- **Unchecked**: Standard information logging only
- **Checked**: Verbose logging including:
  - SQL queries executed
  - Row counts for each query
  - Detailed error messages with stack traces
  - Per-person processing information

**Recommendation:** Enable only when troubleshooting issues. Disable for production to reduce log noise.

---

## Data Structure

### Person Object

Each person exported to HelloID contains:

#### Core Fields (Required)

| Field | Description |
|-------|-------------|
| `ExternalId` | Unique identifier for the person |
| `DisplayName` | Full display name |

#### Personal Information

| Field | Description |
|-------|-------------|
| `given_name` | First name |
| `family_name` | Last name |
| `family_name_prefix` | Name prefix (e.g., "van", "de") |
| `family_name_partner` | Partner's last name |
| `family_name_partner_prefix` | Partner's name prefix |
| `nick_name` | Preferred name / nickname |
| `initials` | Initials |
| `convention` | Name convention (e.g., "PartnerName", "OwnName") |
| `user_name` | Username |
| `gender` | Gender |
| `birth_date` | Date of birth (YYYY-MM-DD) |
| `birth_locality` | Place of birth |
| `marital_status` | Marital status |
| `honorific_prefix` | Title prefix (e.g., "Dr.", "Mr.") |
| `honorific_suffix` | Title suffix (e.g., "Jr.", "III") |

#### Status Fields

| Field | Description |
|-------|-------------|
| `blocked` | Boolean - person is blocked |
| `excluded` | Boolean - person is excluded from processing |
| `status_reason` | Reason for blocked/excluded status |

#### Business Contact Information

| Field | Description |
|-------|-------------|
| `contact_business_email` | Work email address |
| `contact_business_phone_fixed` | Work phone number |
| `contact_business_phone_mobile` | Work mobile number |
| `contact_business_address_street` | Street name |
| `contact_business_address_street_ext` | Street extension |
| `contact_business_address_house_number` | House number |
| `contact_business_address_house_number_ext` | House number extension |
| `contact_business_address_postal` | Postal/ZIP code |
| `contact_business_address_locality` | City |
| `contact_business_address_country` | Country |

#### Personal Contact Information

| Field | Description |
|-------|-------------|
| `contact_personal_email` | Personal email address |
| `contact_personal_phone_fixed` | Home phone number |
| `contact_personal_phone_mobile` | Personal mobile number |
| `contact_personal_address_street` | Street name |
| `contact_personal_address_street_ext` | Street extension |
| `contact_personal_address_house_number` | House number |
| `contact_personal_address_house_number_ext` | House number extension |
| `contact_personal_address_postal` | Postal/ZIP code |
| `contact_personal_address_locality` | City |
| `contact_personal_address_country` | Country |

#### Custom Fields

Custom fields from the Vault database are expanded with the prefix `custom_`:
- `custom_FieldName` - Any custom field defined in the source system

#### Contracts Array

Each person includes a `Contracts` array. See Contract Object below.

---

### Contract Object

Each contract within the Contracts array contains:

#### Core Fields (Required)

| Field | Description |
|-------|-------------|
| `contract_external_id` | Unique identifier for the contract |
| `contract_start_date` | Contract start date (YYYY-MM-DD) |

#### Department

| Field | Description |
|-------|-------------|
| `department_external_id` | Department ExternalId |
| `department_display_name` | Department name |
| `department_code` | Department code |

#### Title

| Field | Description |
|-------|-------------|
| `title_external_id` | Job title ExternalId |
| `title_name` | Job title name |
| `title_code` | Job title code |

#### Location

| Field | Description |
|-------|-------------|
| `location_external_id` | Location ExternalId |
| `location_name` | Location name |
| `location_code` | Location code |

#### Cost Center

| Field | Description |
|-------|-------------|
| `cost_center_external_id` | Cost center ExternalId |
| `cost_center_name` | Cost center name |
| `cost_center_code` | Cost center code |

#### Cost Bearer

| Field | Description |
|-------|-------------|
| `cost_bearer_external_id` | Cost bearer ExternalId |
| `cost_bearer_name` | Cost bearer name |
| `cost_bearer_code` | Cost bearer code |

#### Employer

| Field | Description |
|-------|-------------|
| `employer_external_id` | Employer ExternalId |
| `employer_name` | Employer name |
| `employer_code` | Employer code |

#### Team

| Field | Description |
|-------|-------------|
| `team_external_id` | Team ExternalId |
| `team_name` | Team name |
| `team_code` | Team code |

#### Division

| Field | Description |
|-------|-------------|
| `division_external_id` | Division ExternalId |
| `division_name` | Division name |
| `division_code` | Division code |

#### Organization

| Field | Description |
|-------|-------------|
| `organization_external_id` | Organization ExternalId |
| `organization_name` | Organization name |
| `organization_code` | Organization code |

#### Manager

| Field | Description |
|-------|-------------|
| `manager_external_id` | Manager's person ExternalId |
| `manager_display_name` | Manager's display name |

#### Contract Details

| Field | Description |
|-------|-------------|
| `contract_sequence` | Contract sequence number |
| `contract_end_date` | Contract end date (YYYY-MM-DD) |
| `contract_type_code` | Contract type code |
| `contract_type_description` | Contract type description |
| `contract_fte` | Full-time equivalent |
| `contract_hours_per_week` | Hours per week |
| `contract_percentage` | Employment percentage |

#### Custom Contract Fields

Custom contract fields are expanded with prefix `contract_custom_`:
- `contract_custom_FieldName` - Any custom contract field

---

### Department Object

Each department exported to HelloID contains:

#### Required Fields

| Field | Description |
|-------|-------------|
| `ExternalId` | Unique identifier for the department |
| `DisplayName` | Department display name |

#### Additional Fields

| Field | Description |
|-------|-------------|
| `code` | Department code |
| `parent_external_id` | ExternalId of parent department (for hierarchy) |
| `ManagerExternalId` | ExternalId of the department manager |
| `manager_display_name` | Manager's display name |
| `source` | Source system name |

---

## Field Mappings

The `mapping.json` file defines how Vault fields map to HelloID person and contract fields.

### Person Mappings

| HelloID Field | Vault Field | Required |
|---------------|-------------|----------|
| ExternalId | ExternalId | Yes |
| Name.GivenName | given_name | No |
| Name.FamilyName | family_name | Yes |
| Name.FamilyNamePrefix | family_name_prefix | No |
| Name.FamilyNamePartner | family_name_partner | No |
| Name.FamilyNamePartnerPrefix | family_name_partner_prefix | No |
| Name.NickName | nick_name | Yes |
| Name.Initials | initials | No |
| Name.Convention | convention | Yes |
| UserName | user_name | No |
| Contact.Business.Email | contact_business_email | No |
| Contact.Business.Phone.Fixed | contact_business_phone_fixed | No |
| Contact.Business.Phone.Mobile | contact_business_phone_mobile | No |

### Contract Mappings

| HelloID Field | Vault Field | Required |
|---------------|-------------|----------|
| ExternalId | contract_external_id | Yes |
| StartDate | contract_start_date | Yes |
| EndDate | contract_end_date | No |
| Department.ExternalId | department_external_id | Yes |
| Department.DisplayName | department_display_name | No |
| Title.ExternalId | title_external_id | Yes |
| Title.Name | title_name | No |
| Title.Code | title_code | No |
| Manager.ExternalId | manager_external_id | No |
| Details.Fte | contract_fte | No |
| Details.HoursPerWeek | contract_hours_per_week | No |
| Details.Percentage | contract_percentage | No |
| Details.Sequence | contract_sequence | No |
| Type.Code | contract_type_code | No |
| Type.Description | contract_type_description | No |
| CostCenter.ExternalId | cost_bearer_external_id | No |
| CostCenter.Name | cost_center_name | No |
| CostCenter.Code | cost_center_code | No |
| Employer.ExternalId | employer_external_id | No |
| Employer.Name | employer_name | No |
| Employer.Code | pos_Werkgever_code | No |

---

## Troubleshooting

### Common Issues

#### Database File Not Found

**Error:** `SQLite query error: HelloID.SQLite wrapper DLL not found`

**Solution:**
1. Verify the `Wrapper DLL Path` configuration is correct
2. Ensure the HelloID agent service has read access to the DLL
3. Use full path with forward slashes: `C:/HelloID/SourceData/HelloID.SQLite.dll`

#### Unable to Open Database

**Error:** `SQLite query error: unable to open database file`

**Solution:**
1. Verify the `Database Path` configuration is correct
2. Ensure the database file exists
3. Check that the HelloID agent service has read access to the database file
4. Verify no other process has an exclusive lock on the database

#### No Persons or Departments Imported

**Symptom:** Import completes but 0 persons/departments are found

**Solution:**
1. Check the `Source System Filter` - if set incorrectly, no data may match
2. Verify the database contains data by querying directly
3. Enable Debug Mode to see row counts returned by each query
4. Ensure persons/departments have valid `external_id` values (null values are excluded)

#### Contract Data Missing

**Symptom:** Persons imported but contracts array is empty

**Solution:**
1. Check `Include Inactive Contracts` setting if contracts have end dates
2. Verify contracts exist in the database with valid `person_id` references
3. Check if `Source System Filter` is filtering out contracts
4. Enable Debug Mode to see contract query row counts

### Using Debug Mode

Enable Debug Mode to troubleshoot issues:

1. Check **Debug Mode** in the configuration
2. Run the import
3. Review the verbose logs for:
   - SQL queries being executed
   - Row counts for each query
   - Processing details for each person/department
   - Full error messages with stack traces

**Sample Debug Output:**
```
Starting Vault SQLite person import from: C:\ProgramData\HelloID.Vault.Management\vault.db
Connecting to SQLite...
Executing SQLite query using HelloID.SQLite wrapper...
Query returned 150 rows
Found 150 persons
Executing SQLite query using HelloID.SQLite wrapper...
Query returned 225 rows
Found 225 contacts
Processing person: EMP001
Processing person: EMP002
...
Successfully enhanced and exported person objects to HelloID. Result count: 150
```

---

## Version History

| Version | Date | Changes |
|---------|------|---------|
| 1.0.0 | - | Initial release |

---

## Related Resources

- **HelloID Documentation:** [HelloID Docs](https://docs.helloid.com/)
- **HelloID Vault Management:** Source application that generates the Vault database
- **HelloID.SQLite.dll:** Required wrapper library for SQLite connectivity

---

## Support

For issues with this connector:

1. Enable Debug Mode and review the logs
2. Verify all prerequisites are met
3. Check database connectivity and file permissions
4. Contact your HelloID administrator or Tools4ever support

---

## License

This connector is provided by Tools4ever for use with HelloID provisioning.
