<Window x:Class="HelloID.Vault.Management.Views.Persons.ContractEditWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:ui="http://schemas.modernwpf.com/2019"
        xmlns:dotNetKitControls="clr-namespace:DotNetKit.Windows.Controls;assembly=DotNetKit.Wpf.AutoCompleteComboBox"
        mc:Ignorable="d"
        Title="{Binding Title}" Height="750" Width="600"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="12">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Title -->
            <TextBlock Text="{Binding Title}"
                       FontSize="16"
                       FontWeight="SemiBold"
                       Margin="0,0,0,12"/>

            <!-- Error Message -->
            <TextBlock Grid.Row="1"
                       Text="{Binding ErrorMessage}"
                       Foreground="Red"
                       FontSize="12"
                       TextWrapping="Wrap"
                       Margin="0,0,0,8"
                       Visibility="{Binding ErrorMessage, Converter={StaticResource NullToCollapsedConverter}}"/>

            <!-- Form - 2 Columns -->
            <Grid Grid.Row="2">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="12"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Left Column -->
                <StackPanel Grid.Column="0">
                    <!-- General Identity -->
                    <TextBlock Text="General Identity"
                               FontSize="12"
                               FontWeight="SemiBold"
                               Margin="0,0,0,8"/>

                    <Grid Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="90"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="External ID" FontSize="12" VerticalAlignment="Center" Margin="0,0,0,6"/>
                        <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding Contract.ExternalId, UpdateSourceTrigger=PropertyChanged}" FontSize="12" Margin="0,0,0,6"/>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Start Date" FontSize="12" VerticalAlignment="Center" Margin="0,0,0,6"/>
                        <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding Contract.StartDate, UpdateSourceTrigger=PropertyChanged}" FontSize="12" Margin="0,0,0,6"/>

                        <TextBlock Grid.Row="2" Grid.Column="0" Text="End Date" FontSize="12" VerticalAlignment="Center" Margin="0,0,0,6"/>
                        <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding Contract.EndDate, UpdateSourceTrigger=PropertyChanged}" FontSize="12" Margin="0,0,0,6"/>

                        <TextBlock Grid.Row="3" Grid.Column="0" Text="Source *" FontSize="12" VerticalAlignment="Center"/>
                        <ComboBox Grid.Row="3" Grid.Column="1"
                                  ItemsSource="{Binding SourceSystems}"
                                  SelectedItem="{Binding SelectedSourceSystem}"
                                  SelectedValuePath="SystemId"
                                  DisplayMemberPath="DisplayName"
                                  SelectedValue="{Binding Contract.Source}"
                                  FontSize="12"/>
                    </Grid>

                    <!-- Job Statistics -->
                    <TextBlock Text="Job Statistics"
                               FontSize="12"
                               FontWeight="SemiBold"
                               Margin="0,0,0,8"/>

                    <Grid Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="4"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="4"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="FTE" FontSize="12" Margin="0,0,0,4"/>
                        <TextBox Grid.Row="1" Grid.Column="0" Text="{Binding Contract.Fte, UpdateSourceTrigger=PropertyChanged}" FontSize="12"/>

                        <TextBlock Grid.Row="0" Grid.Column="2" Text="Hours/Week" FontSize="12" Margin="0,0,0,4"/>
                        <TextBox Grid.Row="1" Grid.Column="2" Text="{Binding Contract.HoursPerWeek, UpdateSourceTrigger=PropertyChanged}" FontSize="12"/>

                        <TextBlock Grid.Row="0" Grid.Column="4" Text="Percentage" FontSize="12" Margin="0,0,0,4"/>
                        <TextBox Grid.Row="1" Grid.Column="4" Text="{Binding Contract.Percentage, UpdateSourceTrigger=PropertyChanged}" FontSize="12"/>
                    </Grid>

                    <!-- Job Details -->
                    <TextBlock Text="Job Details"
                               FontSize="12"
                               FontWeight="SemiBold"
                               Margin="0,0,0,8"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="90"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Title" FontSize="12" VerticalAlignment="Center" Margin="0,0,0,6"/>
                        <ComboBox Grid.Row="0" Grid.Column="1" ItemsSource="{Binding Titles}" SelectedValue="{Binding Contract.TitleExternalId}" SelectedValuePath="ExternalId" DisplayMemberPath="Name" FontSize="12" Margin="0,0,0,6"/>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Type Code" FontSize="12" VerticalAlignment="Center" Margin="0,0,0,6"/>
                        <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding Contract.TypeCode, UpdateSourceTrigger=PropertyChanged}" FontSize="12" Margin="0,0,0,6"/>

                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Type Desc" FontSize="12" VerticalAlignment="Center" Margin="0,0,0,6"/>
                        <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding Contract.TypeDescription, UpdateSourceTrigger=PropertyChanged}" FontSize="12" Margin="0,0,0,6"/>

                        <TextBlock Grid.Row="3" Grid.Column="0" Text="Sequence" FontSize="12" VerticalAlignment="Center"/>
                        <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding Contract.Sequence, UpdateSourceTrigger=PropertyChanged}" FontSize="12"/>
                    </Grid>
                </StackPanel>

                <!-- Right Column -->
                <StackPanel Grid.Column="2">
                    <!-- Organization -->
                    <TextBlock Text="Organization"
                               FontSize="12"
                               FontWeight="SemiBold"
                               Margin="0,0,0,8"/>

                    <Grid Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="85"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Manager" FontSize="12" VerticalAlignment="Center" Margin="0,0,0,6"/>
                        <dotNetKitControls:AutoCompleteComboBox Grid.Row="0" Grid.Column="1"
                            ItemsSource="{Binding Managers}"
                            SelectedItem="{Binding SelectedManager}"
                            TextSearch.TextPath="DisplayName"
                            DisplayMemberPath="DisplayName"
                            FontSize="12" Margin="0,0,0,6">
                            <dotNetKitControls:AutoCompleteComboBox.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <VirtualizingStackPanel />
                                </ItemsPanelTemplate>
                            </dotNetKitControls:AutoCompleteComboBox.ItemsPanel>
                        </dotNetKitControls:AutoCompleteComboBox>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Department" FontSize="12" VerticalAlignment="Center" Margin="0,0,0,6"/>
                        <ComboBox Grid.Row="1" Grid.Column="1" ItemsSource="{Binding Departments}" SelectedValue="{Binding Contract.DepartmentExternalId}" SelectedValuePath="ExternalId" DisplayMemberPath="DisplayName" FontSize="12" Margin="0,0,0,6"/>

                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Location" FontSize="12" VerticalAlignment="Center" Margin="0,0,0,6"/>
                        <ComboBox Grid.Row="2" Grid.Column="1" ItemsSource="{Binding Locations}" SelectedValue="{Binding Contract.LocationExternalId}" SelectedValuePath="ExternalId" DisplayMemberPath="Name" FontSize="12" Margin="0,0,0,6"/>

                        <TextBlock Grid.Row="3" Grid.Column="0" Text="Division" FontSize="12" VerticalAlignment="Center" Margin="0,0,0,6"/>
                        <ComboBox Grid.Row="3" Grid.Column="1" ItemsSource="{Binding Divisions}" SelectedValue="{Binding Contract.DivisionExternalId}" SelectedValuePath="ExternalId" DisplayMemberPath="Name" FontSize="12" Margin="0,0,0,6"/>

                        <TextBlock Grid.Row="4" Grid.Column="0" Text="Team" FontSize="12" VerticalAlignment="Center" Margin="0,0,0,6"/>
                        <ComboBox Grid.Row="4" Grid.Column="1" ItemsSource="{Binding Teams}" SelectedValue="{Binding Contract.TeamExternalId}" SelectedValuePath="ExternalId" DisplayMemberPath="Name" FontSize="12" Margin="0,0,0,6"/>

                        <TextBlock Grid.Row="5" Grid.Column="0" Text="Organization" FontSize="12" VerticalAlignment="Center" Margin="0,0,0,6"/>
                        <ComboBox Grid.Row="5" Grid.Column="1" ItemsSource="{Binding Organizations}" SelectedValue="{Binding Contract.OrganizationExternalId}" SelectedValuePath="ExternalId" DisplayMemberPath="Name" FontSize="12" Margin="0,0,0,6"/>

                        <TextBlock Grid.Row="6" Grid.Column="0" Text="Employer" FontSize="12" VerticalAlignment="Center"/>
                        <ComboBox Grid.Row="6" Grid.Column="1" ItemsSource="{Binding Employers}" SelectedValue="{Binding Contract.EmployerExternalId}" SelectedValuePath="ExternalId" DisplayMemberPath="Name" FontSize="12"/>
                    </Grid>

                    <!-- Cost Allocation -->
                    <TextBlock Text="Cost Allocation"
                               FontSize="12"
                               FontWeight="SemiBold"
                               Margin="0,0,0,8"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="85"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Cost Center" FontSize="12" VerticalAlignment="Center" Margin="0,0,0,6"/>
                        <ComboBox Grid.Row="0" Grid.Column="1" ItemsSource="{Binding CostCenters}" SelectedValue="{Binding Contract.CostCenterExternalId}" SelectedValuePath="ExternalId" DisplayMemberPath="Name" FontSize="12" Margin="0,0,0,6"/>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Cost Bearer" FontSize="12" VerticalAlignment="Center"/>
                        <ComboBox Grid.Row="1" Grid.Column="1" ItemsSource="{Binding CostBearers}" SelectedValue="{Binding Contract.CostBearerExternalId}" SelectedValuePath="ExternalId" DisplayMemberPath="Name" FontSize="12"/>
                    </Grid>
                </StackPanel>
            </Grid>

            <!-- Custom Fields Section - Full Width -->
            <StackPanel Grid.Row="3" Margin="0,0,0,0"
                       Visibility="{Binding HasCustomFields, Converter={StaticResource BooleanToVisibilityConverter}}">

                <!-- Separator Line -->
                <Separator Margin="0,8,0,8"/>

                <!-- Section Header -->
                <TextBlock Text="Custom Fields"
                           FontSize="12"
                           FontWeight="SemiBold"
                           Margin="0,0,0,8"/>

                <!-- Custom Fields List -->
                <ItemsControl ItemsSource="{Binding CustomFields}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Grid Margin="0,0,0,6">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0" Text="{Binding DisplayName}" FontSize="12" VerticalAlignment="Center"/>
                                <TextBox Grid.Column="1" Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}" FontSize="12"/>
                            </Grid>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>

            <!-- Buttons -->
            <Grid Grid.Row="4" Margin="0,16,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Button Grid.Column="1"
                        Content="Save"
                        Command="{Binding SaveCommand}"
                        CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
                        Style="{StaticResource AccentButtonStyle}"
                        FontSize="12"
                        Width="80"
                        Margin="0,0,8,0"
                        IsDefault="True"/>

                <Button Grid.Column="2"
                        Content="Cancel"
                        Command="{Binding CancelCommand}"
                        CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
                        FontSize="12"
                        Width="80"
                        IsCancel="True"/>
            </Grid>

            <!-- Loading Overlay -->
            <Grid Grid.RowSpan="5"
                  Background="#80FFFFFF"
                  Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
                <ui:ProgressRing IsActive="{Binding IsLoading}" Width="50" Height="50"/>
            </Grid>
        </Grid>
    </ScrollViewer>
</Window>
