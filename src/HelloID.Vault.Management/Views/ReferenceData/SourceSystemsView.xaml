<UserControl x:Class="HelloID.Vault.Management.Views.ReferenceData.SourceSystemsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:ui="http://schemas.modernwpf.com/2019"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="1400">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header Panel -->
        <Border Grid.Row="0"
                Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                Padding="16"
                BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                BorderThickness="0,0,0,1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Title Section -->
                <StackPanel Grid.Column="0" Margin="0,0,16,0">
                    <TextBlock Text="Source Systems"
                              FontSize="20"
                              FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding TotalCount, StringFormat='{}{0} source systems'}"
                              FontSize="14"
                              FontWeight="SemiBold"
                              Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                              Margin="0,4,0,0"/>
                    <TextBlock Text="{Binding UnusedCount, StringFormat='{}{0} unused systems'}"
                              FontSize="12"
                              Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                              Margin="0,2,0,0"/>
                </StackPanel>

                <!-- Search Box -->
                <ui:AutoSuggestBox Grid.Column="1"
                                   PlaceholderText="Search source systems (name, identification key)..."
                                   Text="{Binding SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                   QueryIcon="Find"
                                   VerticalAlignment="Center"
                                   HorizontalAlignment="Center"
                                   MinWidth="600"
                                   MaxWidth="900"
                                   FontSize="14"/>

                <!-- Action Buttons -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                    <ui:AppBarButton Label="Add Source"
                                    Command="{Binding AddSourceSystemCommand}">
                        <ui:AppBarButton.Icon>
                            <ui:FontIcon Glyph="&#xE710;"/>
                        </ui:AppBarButton.Icon>
                    </ui:AppBarButton>
                    <ui:AppBarButton Label="Edit"
                                    Command="{Binding EditSourceSystemCommand}">
                        <ui:AppBarButton.Icon>
                            <ui:FontIcon Glyph="&#xE70F;"/>
                        </ui:AppBarButton.Icon>
                    </ui:AppBarButton>
                    <Separator Margin="8,0"/>
                    <ui:AppBarButton Label="Refresh"
                                    Command="{Binding RefreshCommand}">
                        <ui:AppBarButton.Icon>
                            <ui:FontIcon Glyph="&#xE72C;"/>
                        </ui:AppBarButton.Icon>
                    </ui:AppBarButton>
                    <Separator Margin="8,0"/>
                    <ui:AppBarButton Label="Usage Statistics"
                                    Command="{Binding ShowUsageStatisticsCommand}">
                        <ui:AppBarButton.Icon>
                            <ui:FontIcon Glyph="&#xE9D2;"/>
                        </ui:AppBarButton.Icon>
                    </ui:AppBarButton>
                    <ui:AppBarButton Label="Unused Systems"
                                    Command="{Binding ShowUnusedSourceSystemsCommand}">
                        <ui:AppBarButton.Icon>
                            <ui:FontIcon Glyph="&#xE71C;"/>
                        </ui:AppBarButton.Icon>
                    </ui:AppBarButton>
                    <Separator Margin="8,0"/>
                    <ui:AppBarButton Icon="Undo"
                                    Label="Reset Settings"
                                    Command="{Binding ResetSettingsCommand}"
                                    ToolTip="Clear search and selection"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- DataGrid Content -->
        <Grid Grid.Row="1">
            <DataGrid ItemsSource="{Binding SourceSystems}"
                     SelectedItem="{Binding SelectedSourceSystem}"
                     AutoGenerateColumns="False"
                     IsReadOnly="True"
                     CanUserAddRows="False"
                     CanUserDeleteRows="False"
                     CanUserReorderColumns="True"
                     CanUserSortColumns="True"
                     SelectionMode="Single"
                     GridLinesVisibility="Horizontal"
                     HeadersVisibility="Column"
                     RowHeaderWidth="0"
                     BorderThickness="0">

                <!-- Context Menu -->
                <DataGrid.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="Copy" Command="ApplicationCommands.Copy">
                            <MenuItem.Icon>
                                <ui:FontIcon Glyph="&#xE8C8;"/>
                            </MenuItem.Icon>
                        </MenuItem>
                    </ContextMenu>
                </DataGrid.ContextMenu>

                <DataGrid.Columns>
                    <!-- System ID -->
                    <DataGridTextColumn Header="System ID"
                                        Binding="{Binding SystemId}"
                                        Width="280"
                                        IsReadOnly="True"/>

                    <!-- Display Name -->
                    <DataGridTextColumn Header="Display Name"
                                        Binding="{Binding DisplayName}"
                                        Width="250"
                                        IsReadOnly="True"/>

                    <!-- Identification Key -->
                    <DataGridTextColumn Header="Identification Key"
                                        Binding="{Binding IdentificationKey}"
                                        Width="280"
                                        IsReadOnly="True"/>

                    <!-- Reference Count (important for usage tracking) -->
                    <DataGridTextColumn Header="References"
                                        Binding="{Binding ReferenceCount}"
                                        Width="120"
                                        IsReadOnly="True">

                    </DataGridTextColumn>

                    <!-- Created At -->
                    <DataGridTextColumn Header="Created At"
                                        Binding="{Binding CreatedAt, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}"
                                        Width="150"
                                        IsReadOnly="True"/>
                </DataGrid.Columns>
            </DataGrid>

            <!-- Loading Overlay -->
            <Border Background="#CC000000"
                   Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}">
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                    <ui:ProgressRing IsActive="{Binding IsBusy}"
                                    Width="60"
                                    Height="60"
                                    Margin="0,0,0,16"/>
                    <TextBlock Text="Loading source systems..."
                              Foreground="White"
                              FontSize="14"
                              HorizontalAlignment="Center"/>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="2"
                Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                Padding="16,8"
                BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                BorderThickness="0,1,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Status Information -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="Source systems provide data provenance tracking and namespace isolation"
                              FontSize="12"
                              Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                              VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Item Count -->
                <TextBlock Grid.Column="1"
                          Text="{Binding SourceSystems.Count, StringFormat='{}Showing {0} items'}"
                          FontSize="12"
                          Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                          VerticalAlignment="Center"/>
            </Grid>
        </Border>
    </Grid>
</UserControl>